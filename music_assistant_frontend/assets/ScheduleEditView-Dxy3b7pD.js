import{d as W,r as p,c as D,G as Y,o as Z,w as x,b as c,e as n,f as i,H as t,E as d,$ as _,u,aW as ee,a1 as r,aX as ae,F as P,M as z,aN as se,I as le,J as te,K as ie,D as E,g as oe,aY as de,an as M}from"./lucide-CUgULc1Y.js";import{_ as v}from"./index-Df_fN0sv.js";import{c as h,_ as ne}from"./index-BhoKnNWl.js";import{b as ue,u as re}from"./vue-router-Y1UxNETo.js";import{l as ce,m as U,a4 as me,R as N,c as pe,_ as _e,D as ve,d as q,a5 as L,o as he}from"./vuetify-DpejJ-DC.js";import{u as ye}from"./vue-i18n-Cet7hT3m.js";import"./utils-CDN07tui.js";import"./reka-ui-CPonaMqy.js";import"./vueuse-BUvXlxtB.js";import"./qrcode-CK8KsgMo.js";import"./marked-C0Rlrcoy.js";import"./color-BDgtjUiw.js";/* empty css            */import"./swiper-HCRODQv4.js";const fe={class:"schedule-edit-view"},Ve={class:"schedule-edit-header"},be={class:"text-h6"},ge={class:"header-actions"},we={key:0,class:"loading-state"},ke={key:1,class:"schedule-form-compact"},$e={class:"form-row"},Ce={class:"form-row time-days-row"},Pe={class:"days-chips-inline"},ze={class:"form-section-compact"},Ue={class:"section-header"},Ne={class:"section-label"},Fe={class:"players-grid"},Ie={class:"volume-compact"},Se=["onUpdate:modelValue"],Be={class:"volume-value"},De={class:"form-section-compact"},Ee={class:"section-header"},Me={class:"section-label"},qe={class:"playlist-selector"},Le={class:"text-caption"},Re={key:0,class:"selected-media"},Te={class:"media-name"},Ae={class:"playback-options-inline"},Oe=W({name:"ScheduleEditView",__name:"ScheduleEditView",setup(Xe){const F=ue(),V=re(),{t:b}=ye(),y=p(!0),g=p(!1),w=p(!1),k=D(()=>F.params.id),$=D(()=>!k.value||k.value==="new"),R=["mon","tue","wed","thu","fri","sat","sun"],s=Y({schedule_id:"",name:"",enabled:!0,start_time:"09:00",end_time:"18:00",days_of_week:[0,1,2,3,4],media_items:[],players:[],group_players:!1,loop_content:!0,shuffle:!1,announcements:[]}),I=p([]),C=p([]),f=p(null),T={required:e=>!!e||b("settings.invalid_input")},A=async()=>{try{const e=await h.getPlayerQueues();I.value=e.map(a=>({player_id:a.queue_id,name:a.display_name||a.queue_id}))}catch(e){console.error("Failed to load players:",e)}},O=async()=>{w.value=!0;try{const e=await h.getLibraryPlaylists();C.value=e.map(a=>({uri:a.uri,name:a.name,provider:a.provider_mappings?.[0]?.provider_domain||"library",image:a.metadata?.images?.[0]?.path||a.image?.path}))}catch(e){console.error("Failed to load playlists:",e)}w.value=!1},S=async()=>{if($.value){y.value=!1;return}try{const e=await h.sendCommand("schedule/get",{schedule_id:k.value});Object.assign(s,e),s.media_items.length>0&&(f.value=s.media_items[0])}catch(e){console.error("Failed to load schedule:",e),V.push("/schedule")}y.value=!1},X=e=>{const a=s.days_of_week.indexOf(e);a>=0?s.days_of_week.splice(a,1):(s.days_of_week.push(e),s.days_of_week.sort())},j=()=>{s.players.push({player_id:"",volume:50})},G=e=>{s.players.splice(e,1)},H=e=>{e&&!s.media_items.includes(e)&&s.media_items.push(e),setTimeout(()=>{f.value=null},100)},J=e=>{s.media_items.splice(e,1)},K=e=>{const a=C.value.find(o=>o.uri===e);if(a)return a.name;const l=e.split("/");return l[l.length-1]||e},Q=async()=>{if(!s.name){alert(b("schedule.name_required"));return}g.value=!0;try{const e={...s};e.media_items=e.media_items.filter(a=>a.trim()),e.players=e.players.filter(a=>a.player_id),$.value?await h.sendCommand("schedule/create",e):await h.sendCommand("schedule/update",e),V.push("/schedule")}catch(e){console.error("Failed to save schedule:",e),alert(b("schedule.save_failed"))}g.value=!1},B=()=>{V.push("/schedule")};return Z(async()=>{await Promise.all([A(),O()]),await S()}),x(()=>F.params.id,()=>{y.value=!0,S()}),(e,a)=>(n(),c("div",fe,[i("div",Ve,[t(u(v),{variant:"ghost",size:"sm",onClick:B},{default:d(()=>[t(u(ee),{class:"size-4"}),_(" "+r(e.$t("back")),1)]),_:1}),i("h1",be,r($.value?e.$t("schedule.new"):e.$t("schedule.edit")),1),i("div",ge,[t(u(v),{variant:"outline",size:"sm",onClick:B},{default:d(()=>[_(r(e.$t("cancel")),1)]),_:1}),t(u(v),{size:"sm",disabled:g.value,onClick:Q},{default:d(()=>[t(u(ae),{class:"size-4"}),_(" "+r(e.$t("schedule.save")),1)]),_:1},8,["disabled"])])]),y.value?(n(),c("div",we,[t(ce,{indeterminate:"",size:"24"})])):(n(),c("div",ke,[i("div",$e,[t(U,{modelValue:s.name,"onUpdate:modelValue":a[0]||(a[0]=l=>s.name=l),label:e.$t("schedule.name"),rules:[T.required],variant:"outlined",density:"compact","hide-details":"",class:"name-field"},null,8,["modelValue","label","rules"]),t(me,{modelValue:s.enabled,"onUpdate:modelValue":a[1]||(a[1]=l=>s.enabled=l),label:e.$t("schedule.enabled"),color:"primary","hide-details":"",density:"compact",class:"enable-switch"},null,8,["modelValue","label"])]),i("div",Ce,[t(U,{modelValue:s.start_time,"onUpdate:modelValue":a[2]||(a[2]=l=>s.start_time=l),label:e.$t("schedule.start_time"),type:"time",variant:"outlined",density:"compact","hide-details":"",class:"time-field"},null,8,["modelValue","label"]),t(U,{modelValue:s.end_time,"onUpdate:modelValue":a[3]||(a[3]=l=>s.end_time=l),label:e.$t("schedule.end_time"),type:"time",variant:"outlined",density:"compact","hide-details":"",class:"time-field"},null,8,["modelValue","label"]),i("div",Pe,[(n(),c(P,null,z(R,(l,o)=>t(he,{key:o,color:s.days_of_week.includes(o)?"primary":"default",variant:s.days_of_week.includes(o)?"flat":"outlined",size:"small",onClick:m=>X(o)},{default:d(()=>[_(r(e.$t(`days.${l}_short`)),1)]),_:2},1032,["color","variant","onClick"])),64))])]),i("div",ze,[i("div",Ue,[i("span",Ne,r(e.$t("schedule.players")),1),t(u(v),{variant:"ghost",size:"sm",onClick:j},{default:d(()=>[t(u(se),{class:"size-3"})]),_:1})]),i("div",Fe,[(n(!0),c(P,null,z(s.players,(l,o)=>(n(),c("div",{key:o,class:"player-item"},[t(L,{modelValue:l.player_id,"onUpdate:modelValue":m=>l.player_id=m,items:I.value,"item-title":"name","item-value":"player_id",variant:"outlined",density:"compact","hide-details":"",class:"player-select-compact"},null,8,["modelValue","onUpdate:modelValue","items"]),i("div",Ie,[t(q,{size:"16"},{default:d(()=>[...a[8]||(a[8]=[_("mdi-volume-medium",-1)])]),_:1}),oe(i("input",{"onUpdate:modelValue":m=>l.volume=m,type:"range",min:"0",max:"100",class:"volume-range"},null,8,Se),[[de,l.volume,void 0,{number:!0}]]),i("span",Be,r(l.volume)+"%",1)]),t(u(v),{variant:"ghost",size:"icon",class:"remove-btn",onClick:m=>G(o)},{default:d(()=>[t(u(M),{class:"size-3"})]),_:1},8,["onClick"])]))),128))]),t(N,{modelValue:s.group_players,"onUpdate:modelValue":a[4]||(a[4]=l=>s.group_players=l),label:e.$t("schedule.group_players"),density:"compact","hide-details":"",class:"group-checkbox"},null,8,["modelValue","label"])]),i("div",De,[i("div",Ee,[i("span",Me,r(e.$t("schedule.media")),1)]),i("div",qe,[t(L,{modelValue:f.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>f.value=l),H],items:C.value,"item-title":"name","item-value":"uri",label:e.$t("schedule.select_playlist"),variant:"outlined",density:"compact","hide-details":"",clearable:"",loading:w.value},{item:d(({item:l,props:o})=>[t(pe,te(ie(o)),{prepend:d(()=>[t(_e,{size:"32",rounded:"sm"},{default:d(()=>[l.raw.image?(n(),E(ve,{key:0,src:l.raw.image},null,8,["src"])):(n(),E(q,{key:1},{default:d(()=>[...a[9]||(a[9]=[_("mdi-playlist-music",-1)])]),_:1}))]),_:2},1024)]),subtitle:d(()=>[i("span",Le,r(l.raw.provider),1)]),_:2},1040)]),_:1},8,["modelValue","items","label","loading"])]),s.media_items.length?(n(),c("div",Re,[(n(!0),c(P,null,z(s.media_items,(l,o)=>(n(),c("div",{key:o,class:"media-chip"},[i("span",Te,r(K(l)),1),t(u(v),{variant:"ghost",size:"icon",class:"remove-btn-small",onClick:m=>J(o)},{default:d(()=>[t(u(M),{class:"size-3"})]),_:1},8,["onClick"])]))),128))])):le("",!0),i("div",Ae,[t(N,{modelValue:s.loop_content,"onUpdate:modelValue":a[6]||(a[6]=l=>s.loop_content=l),label:e.$t("schedule.loop"),density:"compact","hide-details":""},null,8,["modelValue","label"]),t(N,{modelValue:s.shuffle,"onUpdate:modelValue":a[7]||(a[7]=l=>s.shuffle=l),label:e.$t("schedule.shuffle"),density:"compact","hide-details":""},null,8,["modelValue","label"])])])]))]))}}),ta=ne(Oe,[["__scopeId","data-v-153aaa38"]]);export{ta as default};
