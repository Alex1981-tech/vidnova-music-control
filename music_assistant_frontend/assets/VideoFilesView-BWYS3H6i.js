import{d as Be,r as i,c as ge,w as Se,o as Ee,b as m,e as r,H as t,D as f,I as B,f as c,E as o,F as S,M as oe,u as Ne,aA as Re,a1 as n,$ as v,N as Le,O as w,ad as qe}from"./lucide-CUgULc1Y.js";import{b as Oe,u as Ae}from"./vue-router-Y1UxNETo.js";import{c as _,_ as He}from"./index-BhoKnNWl.js";import{a6 as Ke,n as u,C as We,T as ke,d as V,h as be,b as Ge,j as Xe,a as C,q as E,r as F,m as Ye,Y as W,Z as N,p as R,a5 as Ze,c as je,k as Je}from"./vuetify-DpejJ-DC.js";import{u as Qe}from"./vue-i18n-Cet7hT3m.js";import"./qrcode-CK8KsgMo.js";import"./marked-C0Rlrcoy.js";import"./color-BDgtjUiw.js";import"./vueuse-BUvXlxtB.js";/* empty css            */import"./swiper-HCRODQv4.js";const el={class:"breadcrumb-container"},ll=["onClick"],tl={key:1,class:"breadcrumb-text"},al={class:"text-grey mt-4"},ol={class:"card-thumbnail"},sl=["src"],il=["title"],nl={class:"text-caption text-grey"},rl={class:"mb-3"},ul={class:"mb-2"},dl={class:"text-caption text-center mt-2"},cl={class:"text-truncate"},vl=["src"],fl=Be({__name:"VideoFilesView",setup(ml){const se=Oe(),L=Ae(),{t:U}=Qe(),q=i(!1),b=i([]),d=i(""),G=i("list"),O=i(!1),x=i(null),A=i(null),$e=ge(()=>x.value?`${_.baseUrl||window.location.origin}/video/stream?path=${encodeURIComponent(x.value.path)}`:""),we=e=>e.thumbnail?`${_.baseUrl||window.location.origin}/video/thumbnail?name=${encodeURIComponent(e.thumbnail)}`:void 0,z=i(!1),I=i(""),X=i(!1),M=i(!1),T=i(null),Y=i(!1),D=i(!1),P=i(null),H=i(""),Z=i([]),j=i(!1),ie=i(null),ne=i(null),K=i(!1),J=i(0),re=i(""),Q=i(0),ue=i(0),de=ge(()=>{const e=[];if(e.push({text:U("browse"),path:"__browse__",clickable:!0}),e.push({text:"Video Assistant",path:null,clickable:d.value!==""}),d.value){const a=d.value.split("/").filter(s=>s);let l="";a.forEach((s,h)=>{l=l?`${l}/${s}`:s,e.push({text:s,path:l,clickable:h<a.length-1})})}return e}),y=async()=>{q.value=!0;try{const e=await _.browseMediaFiles("video",d.value);if(d.value){const a=d.value.includes("/")?d.value.substring(0,d.value.lastIndexOf("/")):"";b.value=[{id:"..",name:"..",path:a,is_folder:!0,media_type:"folder",size:0,uri:""},...e]}else b.value=e}catch(e){console.error("Failed to load video files:",e),b.value=[]}q.value=!1},Ve=e=>{d.value=e,L.push({path:"/video",query:e?{path:e}:void 0})},Ce=e=>{e==="__browse__"?L.push({path:"/browse"}):e===null?L.push({path:"/video"}):L.push({path:"/video",query:{path:e}})},ce=e=>{e.is_folder?Ve(e.path):ee(e)},ee=e=>{x.value=e,O.value=!0},Fe=()=>{A.value&&(A.value.pause(),A.value.src=""),x.value=null},Ue=e=>{console.error("Video playback error:",e)},ve=e=>e.id===".."?"folder":e.is_folder?U("video_files.items_count",{count:e.children_count||0}):xe(e.size),xe=e=>{if(e===0)return"0 B";const a=1024,l=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,s)).toFixed(1))+" "+l[s]},fe=()=>{ie.value?.click()},ze=()=>{ne.value?.click()},me=async e=>{const a=e.target,l=a.files;if(!l||l.length===0)return;const s=[".mp4",".mkv",".avi",".mov",".webm",".wmv",".flv"],h=Array.from(l).filter(g=>{const k=g.name.toLowerCase().substring(g.name.lastIndexOf("."));return s.includes(k)||g.type.startsWith("video/")});if(h.length===0){alert(U("video_files.no_video_files")),a.value="";return}ue.value=h.length,Q.value=0,K.value=!0;for(let g=0;g<h.length;g++){const k=h[g],le=k.webkitRelativePath||"",te=le?le.substring(0,le.lastIndexOf("/")):"",Te=d.value?te?`${d.value}/${te}`:d.value:te;re.value=k.name,J.value=0;try{const $=new FormData;$.append("file",k);const De=`${_.baseUrl||window.location.origin}/upload?media_type=video&folder_path=${encodeURIComponent(Te)}`,p=new XMLHttpRequest;await new Promise((Pe,he)=>{p.upload.onprogress=ae=>{ae.lengthComputable&&(J.value=Math.round(ae.loaded/ae.total*100))},p.onload=()=>{p.status>=200&&p.status<300?Pe():he(new Error(`HTTP ${p.status}: ${p.statusText}`))},p.onerror=()=>he(new Error("Network error")),p.open("POST",De),p.send($)}),Q.value++}catch($){console.error("Failed to upload file:",k.name,$),alert(`${U("video_files.upload_failed")}: ${k.name}
${$?.message||$}`)}}K.value=!1,a.value="",y()},pe=async()=>{if(I.value.trim()){X.value=!0;try{await _.createMediaFolder(I.value.trim(),"video",d.value),z.value=!1,I.value="",y()}catch(e){console.error("Failed to create folder:",e)}X.value=!1}},_e=e=>{T.value=e,M.value=!0},Ie=async()=>{if(T.value){Y.value=!0;try{await _.deleteMediaItem(T.value.path,"video"),M.value=!1,T.value=null,y()}catch(e){console.error("Failed to delete item:",e)}Y.value=!1}},ye=async e=>{P.value=e,H.value="";try{const a=await _.listMediaFolders("video");Z.value=a.filter(l=>{const s=e.path.includes("/")?e.path.substring(0,e.path.lastIndexOf("/")):"";return e.is_folder&&l.path===e.path||e.is_folder&&l.path.startsWith(e.path+"/")?!1:l.path!==s})}catch(a){console.error("Failed to load folders:",a),Z.value=[{name:"/",path:""}]}D.value=!0},Me=async()=>{if(P.value){j.value=!0;try{await _.moveMediaItem(P.value.path,H.value,"video"),D.value=!1,P.value=null,y()}catch(e){console.error("Failed to move item:",e),alert(`${U("video_files.move_failed")}: ${e?.message||e}`)}j.value=!1}};return Se(()=>se.query.path,e=>{d.value=e||"",y()},{immediate:!0}),Ee(()=>{d.value=se.query.path||"",y()}),(e,a)=>(r(),m("section",null,[t(We,{color:"transparent",class:"header"},{prepend:o(()=>[t(u,{size:"small",style:{opacity:"0.8"},disabled:""},{default:o(()=>[t(Ne(Re),{class:"w-6 h-6"})]),_:1})]),title:o(()=>[c("div",el,[(r(!0),m(S,null,oe(de.value,(l,s)=>(r(),m("span",{key:s,class:"breadcrumb-segment"},[l.clickable?(r(),m("button",{key:0,class:"breadcrumb-link",onClick:h=>Ce(l.path)},n(l.text),9,ll)):(r(),m("span",tl,n(l.text),1)),s<de.value.length-1?(r(),f(V,{key:2,icon:"mdi-chevron-right",size:"small",class:"breadcrumb-separator"})):B("",!0)]))),128))])]),append:o(()=>[t(Ke,{modelValue:G.value,"onUpdate:modelValue":a[0]||(a[0]=l=>G.value=l),mandatory:"",density:"compact",class:"mr-2"},{default:o(()=>[t(u,{value:"list",size:"small",icon:"mdi-view-list",title:e.$t("video_files.view_list")},null,8,["title"]),t(u,{value:"grid",size:"small",icon:"mdi-view-grid",title:e.$t("video_files.view_grid")},null,8,["title"])]),_:1},8,["modelValue"]),t(u,{icon:"mdi-folder-plus",size:"small",variant:"text",title:e.$t("video_files.create_folder"),onClick:a[1]||(a[1]=l=>z.value=!0)},null,8,["title"]),t(u,{icon:"mdi-file-upload",size:"small",variant:"text",title:e.$t("video_files.upload"),onClick:fe},null,8,["title"]),t(u,{icon:"mdi-folder-upload",size:"small",variant:"text",title:e.$t("video_files.upload_folder"),onClick:ze},null,8,["title"]),t(u,{icon:"mdi-refresh",size:"small",variant:"text",title:e.$t("refresh"),onClick:y},null,8,["title"])]),_:1}),q.value?(r(),f(ke,{key:0,indeterminate:"",color:"primary"})):B("",!0),!q.value&&b.value.length===0?(r(),f(be,{key:1,class:"text-center py-8"},{default:o(()=>[t(V,{icon:"mdi-folder-open-outline",size:"64",color:"grey"}),c("p",al,n(e.$t("video_files.empty")),1),t(u,{color:"primary",variant:"outlined",class:"mt-4",onClick:fe},{default:o(()=>[t(V,{icon:"mdi-upload",start:""}),v(" "+n(e.$t("video_files.upload_first")),1)]),_:1})]),_:1})):G.value==="list"?(r(),f(Ge,{key:2,lines:"two",density:"compact"},{default:o(()=>[(r(!0),m(S,null,oe(b.value,l=>(r(),f(je,{key:l.id,title:l.name,subtitle:ve(l),onClick:s=>ce(l)},{prepend:o(()=>[t(V,{icon:l.is_folder?"mdi-folder":"mdi-video",color:l.is_folder?"amber":"blue",size:"32"},null,8,["icon","color"])]),append:o(()=>[l.id!==".."?(r(),m(S,{key:0},[l.is_folder?B("",!0):(r(),f(u,{key:0,icon:"mdi-play-circle",size:"small",variant:"text",color:"success",title:e.$t("video_files.play"),onClick:w(s=>ee(l),["stop"])},null,8,["title","onClick"])),t(u,{icon:"mdi-folder-move",size:"small",variant:"text",color:"primary",title:e.$t("video_files.move"),onClick:w(s=>ye(l),["stop"])},null,8,["title","onClick"]),t(u,{icon:"mdi-delete",size:"small",variant:"text",color:"error",title:e.$t("delete"),onClick:w(s=>_e(l),["stop"])},null,8,["title","onClick"])],64)):B("",!0)]),_:2},1032,["title","subtitle","onClick"]))),128))]),_:1})):(r(),f(be,{key:3,fluid:"",class:"pa-2"},{default:o(()=>[t(Xe,null,{default:o(()=>[(r(!0),m(S,null,oe(b.value,l=>(r(),f(Je,{key:l.id,cols:"6",sm:"4",md:"3",lg:"2"},{default:o(()=>[t(C,{class:qe(["video-card",{"folder-card":l.is_folder}]),onClick:s=>ce(l)},{default:o(()=>[c("div",ol,[l.is_folder?(r(),f(V,{key:0,icon:"mdi-folder",color:"amber",size:"64"})):(r(),m(S,{key:1},[l.thumbnail?(r(),m("img",{key:0,src:we(l),class:"thumbnail-img",onError:a[2]||(a[2]=s=>s.target.style.display="none")},null,40,sl)):(r(),f(V,{key:1,icon:"mdi-video",color:"blue",size:"48",class:"video-icon"})),t(u,{icon:"mdi-play-circle",size:"large",variant:"text",color:"white",class:"play-overlay",onClick:w(s=>ee(l),["stop"])},null,8,["onClick"])],64))]),t(F,{class:"pa-2"},{default:o(()=>[c("div",{class:"text-subtitle-2 text-truncate",title:l.name},n(l.name),9,il),c("div",nl,n(ve(l)),1)]),_:2},1024),l.id!==".."?(r(),f(W,{key:0,class:"pa-1"},{default:o(()=>[t(N),t(u,{icon:"mdi-folder-move",size:"x-small",variant:"text",title:e.$t("video_files.move"),onClick:w(s=>ye(l),["stop"])},null,8,["title","onClick"]),t(u,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",title:e.$t("delete"),onClick:w(s=>_e(l),["stop"])},null,8,["title","onClick"])]),_:2},1024)):B("",!0)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})),c("input",{ref_key:"fileInput",ref:ie,type:"file",multiple:"",accept:"video/*,.mp4,.mkv,.avi,.mov,.webm,.wmv,.flv",style:{display:"none"},onChange:me},null,544),c("input",{ref_key:"folderInput",ref:ne,type:"file",multiple:"",webkitdirectory:"",style:{display:"none"},onChange:me},null,544),t(R,{modelValue:z.value,"onUpdate:modelValue":a[5]||(a[5]=l=>z.value=l),"max-width":"400"},{default:o(()=>[t(C,null,{default:o(()=>[t(E,null,{default:o(()=>[v(n(e.$t("video_files.create_folder")),1)]),_:1}),t(F,null,{default:o(()=>[t(Ye,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=l=>I.value=l),label:e.$t("video_files.folder_name"),variant:"outlined",density:"compact",autofocus:"",onKeyup:Le(pe,["enter"])},null,8,["modelValue","label"])]),_:1}),t(W,null,{default:o(()=>[t(N),t(u,{variant:"text",onClick:a[4]||(a[4]=l=>z.value=!1)},{default:o(()=>[v(n(e.$t("cancel")),1)]),_:1}),t(u,{color:"primary",variant:"flat",onClick:pe,loading:X.value},{default:o(()=>[v(n(e.$t("create")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:M.value,"onUpdate:modelValue":a[7]||(a[7]=l=>M.value=l),"max-width":"400"},{default:o(()=>[t(C,null,{default:o(()=>[t(E,null,{default:o(()=>[v(n(e.$t("video_files.delete_confirm")),1)]),_:1}),t(F,null,{default:o(()=>[v(n(e.$t("video_files.delete_message",{name:T.value?.name})),1)]),_:1}),t(W,null,{default:o(()=>[t(N),t(u,{variant:"text",onClick:a[6]||(a[6]=l=>M.value=!1)},{default:o(()=>[v(n(e.$t("cancel")),1)]),_:1}),t(u,{color:"error",variant:"flat",onClick:Ie,loading:Y.value},{default:o(()=>[v(n(e.$t("delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=l=>D.value=l),"max-width":"400"},{default:o(()=>[t(C,null,{default:o(()=>[t(E,null,{default:o(()=>[v(n(e.$t("video_files.move_to")),1)]),_:1}),t(F,null,{default:o(()=>[c("p",rl,n(P.value?.name),1),t(Ze,{modelValue:H.value,"onUpdate:modelValue":a[8]||(a[8]=l=>H.value=l),items:Z.value,"item-title":"name","item-value":"path",label:e.$t("video_files.destination"),variant:"outlined",density:"compact"},null,8,["modelValue","items","label"])]),_:1}),t(W,null,{default:o(()=>[t(N),t(u,{variant:"text",onClick:a[9]||(a[9]=l=>D.value=!1)},{default:o(()=>[v(n(e.$t("cancel")),1)]),_:1}),t(u,{color:"primary",variant:"flat",onClick:Me,loading:j.value},{default:o(()=>[v(n(e.$t("video_files.move")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:K.value,"onUpdate:modelValue":a[11]||(a[11]=l=>K.value=l),"max-width":"400",persistent:""},{default:o(()=>[t(C,null,{default:o(()=>[t(E,null,{default:o(()=>[v(n(e.$t("video_files.uploading")),1)]),_:1}),t(F,null,{default:o(()=>[c("p",ul,n(re.value),1),t(ke,{"model-value":J.value,color:"primary",height:"8",rounded:""},null,8,["model-value"]),c("p",dl,n(Q.value)+" / "+n(ue.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:O.value,"onUpdate:modelValue":a[13]||(a[13]=l=>O.value=l),"max-width":"900",onAfterLeave:Fe},{default:o(()=>[t(C,{class:"video-player-card"},{default:o(()=>[t(E,{class:"d-flex align-center"},{default:o(()=>[c("span",cl,n(x.value?.name),1),t(N),t(u,{icon:"mdi-close",variant:"text",size:"small",onClick:a[12]||(a[12]=l=>O.value=!1)})]),_:1}),t(F,{class:"pa-0"},{default:o(()=>[c("video",{ref_key:"videoPlayer",ref:A,src:$e.value,controls:"",autoplay:"",class:"video-element",onError:Ue},n(e.$t("video_files.not_supported")),41,vl)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Ul=He(fl,[["__scopeId","data-v-8d9edfd5"]]);export{Ul as default};
